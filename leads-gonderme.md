# ğŸ“‹ LEAD GÃ–NDERME SÄ°STEMÄ° - DETAYLI AÃ‡IKLAMA

```
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•    â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â•šâ•â•
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ•—
â•šâ•â•â•â•â•â• â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•   â•šâ•â•       â•šâ•â•
```

## ğŸ”´ğŸ”´ğŸ”´ Ã‡OK Ã–NEMLÄ° - ASLA UNUTMA! ğŸ”´ğŸ”´ğŸ”´

Bu dÃ¶kÃ¼man, lead'lerin ustalara nasÄ±l gÃ¶nderileceÄŸini aÃ§Ä±klar.

---

## ğŸš¨ğŸš¨ğŸš¨ KRÄ°TÄ°K KURAL: OTOMATÄ°K GÃ–NDERIM YOK! ğŸš¨ğŸš¨ğŸš¨

### **TÃœM LEAD'LER SADECE ADMÄ°N TARAFINDAN MANUEL GÃ–NDERÄ°LÄ°R!**

```
âŒ ASLA otomatik gÃ¶nderim yapma
âŒ ASLA cron job kullanma
âŒ ASLA scheduled task kullanma
âŒ ASLA auto-assign yapma

âœ… HER ZAMAN admin tÄ±klar
âœ… HER ZAMAN admin kontrol eder
âœ… HER ZAMAN admin onaylar
âœ… HER ZAMAN manuel iÅŸlem
```

---

## ğŸ¯ SÄ°STEM AKIÅI

### **1. Paket SatÄ±n Alma Senaryosu**

#### **Ã–rnek Durum:**
- **Åehir:** Riyadh
- **Hizmet TÃ¼rÃ¼:** Elektrik (electric)
- **3 Usta var:**
  - **Usta A:** BugÃ¼n (Pazartesi) 3'lÃ¼ paket aldÄ± â†’ SÄ±ra: 1
  - **Usta B:** BugÃ¼n (Pazartesi) 3'lÃ¼ paket aldÄ± â†’ SÄ±ra: 2
  - **Usta C:** YarÄ±n (SalÄ±) 3'lÃ¼ paket aldÄ± â†’ SÄ±ra: 3

---

## ğŸ“¦ PAKET SATIN ALINDIKTA NE OLUR?

### **Ä°LK LEAD - ADMÄ°N MANUEL GÃ–NDERÄ°R**

âœ… **Paket satÄ±n alÄ±ndÄ±ÄŸÄ±nda:**
```
- Admin paneline BÄ°LDÄ°RÄ°M gelir
- Admin, yeni paket satÄ±n alÄ±ndÄ±ÄŸÄ±nÄ± gÃ¶rÃ¼r
- Admin, sistemde uygun lead var mÄ± kontrol eder
- Varsa â†’ Admin MANUEL olarak 1 adet lead gÃ¶nderir
```

âŒ **Sistemde lead yoksa:**
```
- Admin bekler
- Yeni lead sisteme girdiÄŸinde
- Admin sÄ±raya gÃ¶re gÃ¶nderir
```

### ğŸ”´ **NEDEN OTOMATÄ°K DEÄÄ°L?**

**Ã‡Ã¼nkÃ¼:**
1. Lead kalitesi admin kontrolÃ¼ gerektirir
2. Usta bilgileri doÄŸru mu kontrol edilmeli
3. Lead usta iÃ§in uygun mu deÄŸerlendirilmeli
4. Her lead deÄŸerli, otomatik spam riski var

---

## ğŸ”” KALAN LEAD'LER - USTA TALEBÄ° Ä°LE

### **Kritik Kural: "LEAD Ä°STE" BUTONU - ZORUNLU!**

**Kalan 2 lead iÃ§in:**

1. âœ… **Usta "Lead Ä°ste" butonuna MUTLAKA basmalÄ±**
   - Bu buton provider dashboard'da olacak
   - Her tÄ±klamada 1 lead isteÄŸi admin paneline dÃ¼ÅŸer
   - Admin panelinde "Yeni Ä°stek" bildirimi gelir

2. âœ… **Admin kontrol eder ve MANUEL gÃ¶nderir:**
   - Usta lead istedi mi? â†’ MÃ¼sait demektir!
   - Sistemde uygun lead var mÄ± kontrol eder
   - Varsa â†’ Admin MANUEL olarak gÃ¶nderir
   - Yoksa â†’ Bekler, yeni lead geldiÄŸinde gÃ¶nderir

3. âŒ **Usta lead isteÄŸi gÃ¶ndermezse:**
   - Lead ASLA GÃ–NDERÄ°LMEZ!
   - Ã‡Ã¼nkÃ¼ mÃ¼sait olup olmadÄ±ÄŸÄ± belli deÄŸil
   - MÃ¼sait olmayan ustaya lead gÃ¶nderilirse:
     - âŒ MÃ¼ÅŸteri hizmet alamaz (usta mÃ¼sait deÄŸil)
     - âŒ Lead boÅŸa gider
     - âŒ DiÄŸer hazÄ±r bekleyen ustalar lead alamaz

### ğŸ¯ **NEDEN "LEAD Ä°STE" BUTONU ZORUNLU?**

**Senaryo 1: Usta mÃ¼sait DEÄÄ°L**
```
Usta A: 3'lÃ¼ paket aldÄ±, 1 lead aldÄ±
  â†“
Usta A: YoÄŸun, ÅŸu an Ã§alÄ±ÅŸamaz
  â†“
"Lead Ä°ste" butonuna BASMIYOR
  â†“
Admin: Usta mÃ¼sait deÄŸil, lead gÃ¶ndermez
  â†“
âœ… Lead boÅŸa gitmedi
âœ… DiÄŸer ustalar lead alabilir
```

**Senaryo 2: Usta MÃœSAÄ°T**
```
Usta B: 3'lÃ¼ paket aldÄ±, 1 lead aldÄ±
  â†“
Usta B: HazÄ±r, yeni mÃ¼ÅŸteri istiyorum
  â†“
"Lead Ä°ste" butonuna BASIYOR
  â†“
Admin: Usta mÃ¼sait! â†’ Lead gÃ¶nder
  â†“
âœ… Usta mÃ¼ÅŸteri aldÄ±
âœ… MÃ¼ÅŸteri hizmet aldÄ±
âœ… Sistem saÄŸlÄ±klÄ± Ã§alÄ±ÅŸÄ±yor
```

---

## ğŸ“Š Ã–RNEK SENARYO - ADIM ADIM

### **Senaryo: 3 Usta, 5 Yeni Lead**

#### **BaÅŸlangÄ±Ã§ Durumu:**
```
Usta A (Pazartesi satÄ±n aldÄ±): 
  - Toplam: 3 lead
  - Kalan: 3 lead
  - Otomatik gÃ¶nderilen: 0

Usta B (Pazartesi satÄ±n aldÄ±):
  - Toplam: 3 lead
  - Kalan: 3 lead
  - Otomatik gÃ¶nderilen: 0

Usta C (SalÄ± satÄ±n aldÄ±):
  - Toplam: 3 lead
  - Kalan: 3 lead
  - Otomatik gÃ¶nderilen: 0
```

---

### **ADIM 1: Paket SatÄ±n Alma (Pazartesi)**

**Usta A, 3'lÃ¼ paket satÄ±n alÄ±r (Saat 10:00):**
```
âœ… Admin paneline BÄ°LDÄ°RÄ°M gelir: "Yeni paket satÄ±n alÄ±ndÄ±"
âœ… Admin kontrol eder: Sistemde 2 lead var (Riyadh + Elektrik)
âœ… Admin MANUEL olarak 1 lead gÃ¶nderir
âœ… Kalan: 2 lead (beklemede - usta isteÄŸi gerekli)
```

**Usta B, 3'lÃ¼ paket satÄ±n alÄ±r (Saat 14:00):**
```
âœ… Admin paneline BÄ°LDÄ°RÄ°M gelir
âœ… Admin kontrol eder: Sistemde 1 lead kaldÄ±
âœ… Admin MANUEL olarak 1 lead gÃ¶nderir
âœ… Kalan: 2 lead (beklemede - usta isteÄŸi gerekli)
```

**Durum Ã–zeti (Pazartesi AkÅŸam):**
```
Usta A: 1 lead aldÄ± (admin gÃ¶nderdi), 2 bekliyor
Usta B: 1 lead aldÄ± (admin gÃ¶nderdi), 2 bekliyor
Sistemde: 0 lead kaldÄ±
Admin: Ä°ki ustaya da ilk lead'i gÃ¶nderdi âœ…
```

---

### **ADIM 2: Yeni Lead Gelir (SalÄ± Sabah)**

**Sistem:** 2 yeni mÃ¼ÅŸteri kaydÄ± geldi (Riyadh + Elektrik)

**Ama kimseye GÃ–NDERÄ°LMEZ Ã§Ã¼nkÃ¼:**
âŒ Usta A "Lead Ä°ste" butonuna basmadÄ±
âŒ Usta B "Lead Ä°ste" butonuna basmadÄ±

```
Lead'ler beklemede kalÄ±r!
```

---

### **ADIM 3: Usta A "Lead Ä°ste" Butonuna Basar**

**Usta A, dashboard'dan "Lead Ä°ste" butonuna tÄ±klar:**
```
âœ… Ä°stek admin paneline dÃ¼ÅŸer
âœ… Admin panelinde BÄ°LDÄ°RÄ°M: "Usta A lead istiyor - MÃœSAÄ°T!"
âœ… Admin kontrol eder: "Sistemde 2 lead var"
âœ… Admin MANUEL olarak 1 lead Usta A'ya gÃ¶nderir
âœ… Ä°stek durumu: "TamamlandÄ±" olarak iÅŸaretlenir
```

**Durum:**
```
Usta A: 2 lead aldÄ±, 1 bekliyor
Usta B: 1 lead aldÄ±, 2 bekliyor (henÃ¼z istemedi - mÃ¼sait deÄŸil!)
Sistemde: 1 lead kaldÄ±
```

---

### **ADIM 4: Usta C Paket SatÄ±n AlÄ±r (SalÄ± Ã–ÄŸleden Sonra)**

**Usta C, 3'lÃ¼ paket satÄ±n alÄ±r:**
```
âœ… Admin paneline BÄ°LDÄ°RÄ°M gelir
âœ… Admin kontrol eder: Sistemde 1 lead var
âœ… Admin MANUEL olarak 1 lead gÃ¶nderir
âœ… Kalan: 2 lead (beklemede - usta isteÄŸi gerekli)
```

**Durum:**
```
Usta A: 2 lead aldÄ±, 1 bekliyor (sÄ±ra: 1)
Usta B: 1 lead aldÄ±, 2 bekliyor (sÄ±ra: 2 - henÃ¼z istemedi!)
Usta C: 1 lead aldÄ±, 2 bekliyor (sÄ±ra: 3)
Sistemde: 0 lead
```

---

### **ADIM 5: Yeni Lead + Talepler**

**3 yeni mÃ¼ÅŸteri kaydÄ± geldi (Ã‡arÅŸamba):**

1. **Usta A "Lead Ä°ste" butonuna basar:**
   - âœ… Ä°stek admin paneline dÃ¼ÅŸer
   - âœ… Admin: "Usta A mÃ¼sait! Sistemde 3 lead var"
   - âœ… Admin MANUEL olarak 1 lead gÃ¶nderir
   - âœ… Usta A'nÄ±n paketi tamamlandÄ±! (3/3)

2. **Usta B "Lead Ä°ste" butonuna basar (ilk kez):**
   - âœ… Ä°stek admin paneline dÃ¼ÅŸer
   - âœ… Admin: "Usta B mÃ¼sait! Sistemde 2 lead var"
   - âœ… Admin MANUEL olarak 1 lead gÃ¶nderir
   - âœ… Usta B: 2/3 lead aldÄ±

3. **Usta B tekrar "Lead Ä°ste" butonuna basar:**
   - âœ… Ä°stek admin paneline dÃ¼ÅŸer
   - âœ… Admin: "Sistemde 1 lead var"
   - âœ… Admin MANUEL olarak 1 lead gÃ¶nderir
   - âœ… Usta B'nin paketi tamamlandÄ±! (3/3)

4. **ArtÄ±k sÄ±ra Usta C'de:**
   - Usta C "Lead Ä°ste" butonuna basarsa
   - Admin bildirimi alÄ±r
   - Admin lead gÃ¶nderir

---

## ğŸš¨ KRÄ°TÄ°K KURALLAR

### âœ… **YAPILMASI GEREKENLER:**

1. **Paket satÄ±n alÄ±ndÄ±ÄŸÄ±nda:**
   - âœ… Admin paneline BÄ°LDÄ°RÄ°M gÃ¶nder
   - âœ… Admin sistemde lead var mÄ± kontrol eder
   - âœ… Varsa â†’ Admin MANUEL olarak 1 adet gÃ¶nderir
   - âœ… Yoksa â†’ Admin bekler, lead geldiÄŸinde gÃ¶nderir

2. **Kalan lead'ler iÃ§in (ZORUNLU):**
   - âœ… Usta "Lead Ä°ste" butonuna MUTLAKA basmalÄ±
   - âœ… Admin panelinde "Yeni Ä°stek" bildirimi gelsin
   - âœ… Admin kontrol edip MANUEL gÃ¶nderir
   - âœ… Ä°stek durumu gÃ¼ncellenir (pending â†’ completed)

3. **SÄ±ralama (Admin kontrolÃ¼):**
   - âœ… Ä°lk satÄ±n alan â†’ Ä°lk sÄ±rada
   - âœ… AynÄ± gÃ¼n satÄ±n alanlar â†’ Saat sÄ±rasÄ±na gÃ¶re
   - âœ… Paket bitince â†’ Sonraki sÄ±raya geÃ§
   - âœ… Admin her zaman sÄ±rayÄ± kontrol eder

### âŒ **YAPILMAMASI GEREKENLER:**

1. **âŒ OTOMATÄ°K GÃ–NDERIM YASAK:**
   - âŒ ASLA otomatik lead gÃ¶nderme
   - âŒ Her ÅŸey admin kontrolÃ¼nde olmalÄ±
   - âŒ "Auto-assign" Ã¶zelliÄŸi YOK

2. **âŒ Ä°stek olmadan gÃ¶nderme:**
   - âŒ Usta istemediÄŸi halde gÃ¶nderme
   - âŒ "Lead Ä°ste" butonu ZORUNLU
   - âŒ MÃ¼sait olmayan ustaya lead gÃ¶nderme

3. **âŒ SÄ±ra atlatma:**
   - âŒ Sonraki ustaya geÃ§me (Ã¶nceki bitmeden/istekte bulunmadan)
   - âŒ Admin bile sÄ±rayÄ± atlayamaz (Ã¶zel durumlar hariÃ§)

### ğŸ”´ **EN Ã–NEMLÄ° KURAL:**

**TÃœM LEAD GÃ–NDERÄ°MLERÄ° ADMÄ°N TARAFINDAN MANUEL YAPILIR!**

**Neden?**
- Lead kalitesi kontrolÃ¼
- Usta mÃ¼saitlik kontrolÃ¼
- DoÄŸru eÅŸleÅŸtirme kontrolÃ¼
- Spam/hata Ã¶nleme

---

## ğŸ¯ SONUÃ‡

### **Sistem MantÄ±ÄŸÄ±:**

```
1. Paket Al â†’ Admin BÄ°LDÄ°RÄ°M alÄ±r
2. Admin Kontrol â†’ Ä°lk Lead MANUEL gÃ¶nderir (varsa)
3. Kalan Lead'ler â†’ Usta "Lead Ä°ste" butonuna basar
4. Admin BÄ°LDÄ°RÄ°M alÄ±r â†’ Kontrol â†’ MANUEL gÃ¶nderir
5. Paket Bitince â†’ Sonraki SÄ±raya
```

### **Neden Bu Sistem?**

âœ… **Admin kontrolÃ¼:** Her lead admin onayÄ± ile gider
âœ… **Usta mÃ¼saitlik kontrolÃ¼:** "Lead Ä°ste" = Ben hazÄ±rÄ±m!
âœ… **Lead kalitesi:** MÃ¼sait usta = daha iyi hizmet
âœ… **Adil daÄŸÄ±tÄ±m:** SÄ±ra sistemi (admin takibi)
âœ… **Spam Ã¶nleme:** Otomatik bombardÄ±man YOK
âœ… **DoÄŸruluk:** Admin lead-usta uyumunu kontrol eder

### **ğŸ”´ TEKRAR: OTOMATÄ°K GÃ–NDERIM YOK!**

**Her lead gÃ¶nderimi:**
- âœ… Admin gÃ¶rÃ¼r
- âœ… Admin kontrol eder
- âœ… Admin tÄ±klayarak gÃ¶nderir
- âœ… Admin onaylar

**ASLA:**
- âŒ Otomatik sistem gÃ¶nderimi yok
- âŒ Scheduled job gÃ¶nderimi yok
- âŒ Cron job gÃ¶nderimi yok

---

## ğŸ“Œ Ã–RNEK DATABASE AKIÅI

### **1. Paket SatÄ±n Alma:**
```sql
INSERT INTO provider_purchases (
    provider_id, package_id, leads_count, remaining_leads, 
    payment_status, purchased_at
) VALUES (
    3, 1, 3, 3, 'completed', NOW()
);
```

### **2. Ä°lk Lead - Admin Manuel GÃ¶nderim:**
```sql
-- Admin panelinde: Yeni paket bildirimi
-- Admin kontrol eder: Sistemde lead var mÄ±?
SELECT * FROM leads 
WHERE city = 'Riyadh' AND service_type = 'electric' 
AND status = 'new' 
LIMIT 1;

-- Admin "Lead GÃ¶nder" butonuna tÄ±klar
INSERT INTO provider_lead_deliveries (
    purchase_id, provider_id, lead_id, 
    delivery_method, delivered_at, delivered_by
) VALUES (
    123, 3, 456, 'admin_manual', NOW(), 1
);

-- Kalan lead'i azalt
UPDATE provider_purchases 
SET remaining_leads = remaining_leads - 1 
WHERE id = 123;

-- Lead durumunu gÃ¼ncelle
UPDATE leads 
SET status = 'sold' 
WHERE id = 456;
```

### **3. "Lead Ä°ste" Ä°steÄŸi:**
```sql
INSERT INTO lead_requests (
    provider_id, purchase_id, 
    request_status, requested_at
) VALUES (
    3, 123, 'pending', NOW()
);
```

### **4. Admin Manuel OnayÄ± ve GÃ¶nderimi:**
```sql
-- Admin panelinde istek gÃ¶rÃ¼nÃ¼r
-- Admin "Lead GÃ¶nder" butonuna tÄ±klar

-- Ä°steÄŸi onayla
UPDATE lead_requests 
SET request_status = 'approved', 
    approved_at = NOW(),
    approved_by = 1  -- admin ID
WHERE id = 789;

-- Lead'i MANUEL gÃ¶nder
INSERT INTO provider_lead_deliveries (
    purchase_id, provider_id, lead_id, 
    delivery_method, delivered_at, delivered_by,
    request_id
) VALUES (
    123, 3, 457, 'admin_manual', NOW(), 1, 789
);

-- Kalan lead'i azalt
UPDATE provider_purchases 
SET remaining_leads = remaining_leads - 1 
WHERE id = 123;

-- Lead durumunu gÃ¼ncelle
UPDATE leads 
SET status = 'sold' 
WHERE id = 457;
```

---

## ğŸ¨ UI/UX GEREKSÄ°NÄ°MLERÄ°

### **Provider Dashboard:**

1. **"Lead Ä°ste" Butonu:**
   ```
   - Her pakette gÃ¶rÃ¼nmeli
   - Kalan lead varsa aktif
   - TÄ±klanÄ±nca â†’ Ä°stek gÃ¶nder
   - Loading animasyonu
   - Success mesajÄ±
   ```

2. **Paket Durumu KartÄ±:**
   ```
   - Toplam Lead: 3
   - AlÄ±nan Lead: 1
   - Kalan Lead: 2
   - "Lead Ä°ste" Butonu (2 kez basabilir)
   ```

### **Admin Panel:**

1. **Yeni Paket Bildirimleri:**
   ```
   - "Yeni Paket SatÄ±n AlÄ±ndÄ±" bildirimi
   - Usta AdÄ± + Paket DetayÄ±
   - "Ä°lk Lead'i GÃ¶nder" butonu
   - Sistemde uygun lead var mÄ± gÃ¶stergesi
   ```

2. **Lead Ä°stekleri Tablosu:**
   ```
   - Usta AdÄ±
   - Paket Bilgisi
   - Ä°stek Tarihi
   - Durum (Beklemede/OnaylandÄ±)
   - "Lead GÃ¶nder" Butonu (MANUEL)
   - Bildirim sayÄ±sÄ± (kaÃ§ bekleyen istek var)
   ```

3. **Lead Havuzu:**
   ```
   - KullanÄ±labilir lead'ler
   - Filtreleme (ÅŸehir, hizmet tÃ¼rÃ¼)
   - "Bu Lead'i GÃ¶nder" butonu
   - Usta seÃ§imi dropdown
   ```

4. **âŒ OTOMATÄ°K KONTROL YOK:**
   ```
   âŒ Otomatik gÃ¶nderim YOK
   âŒ Cron job YOK
   âŒ Auto-assign YOK
   âœ… Sadece MANUEL admin gÃ¶nderimi
   ```

---

## âœ… UYGULAMA PLANI

### **Gerekli Tablolar:**

1. **lead_requests** (yeni tablo):
   ```sql
   CREATE TABLE lead_requests (
       id INT AUTO_INCREMENT PRIMARY KEY,
       provider_id INT NOT NULL,
       purchase_id INT NOT NULL,
       request_status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending',
       requested_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
       approved_at TIMESTAMP NULL,
       approved_by INT NULL,
       notes TEXT NULL,
       FOREIGN KEY (provider_id) REFERENCES service_providers(id),
       FOREIGN KEY (purchase_id) REFERENCES provider_purchases(id),
       FOREIGN KEY (approved_by) REFERENCES admins(id)
   );
   ```

### **Gerekli Fonksiyonlar:**

1. **Backend (PHP) - Provider:**
   - `requestLead()` - Usta lead ister (AJAX endpoint)
   - `getMyRequests()` - UstanÄ±n isteklerini listeler

2. **Backend (PHP) - Admin:**
   - `listPendingRequests()` - Bekleyen istekleri listeler
   - `sendLeadManually()` - Admin MANUEL lead gÃ¶nderir
   - `getPurchaseNotifications()` - Yeni paket bildirimlerini getirir
   - `getAvailableLeads()` - Mevcut lead'leri listeler
   - âŒ `autoAssignLead()` - BU FONKSÄ°YON YOK!
   - âŒ `autoCheckAndSend()` - BU FONKSÄ°YON YOK!

3. **Frontend (JavaScript) - Provider:**
   - `requestLeadButton()` - AJAX request
   - `showRequestStatus()` - Durum gÃ¶ster
   - `updateRemainingLeads()` - Kalan lead gÃ¼ncelle

4. **Frontend (JavaScript) - Admin:**
   - `sendLeadToProvider()` - Lead gÃ¶nder butonu (AJAX)
   - `loadPendingRequests()` - Ä°stekleri yÃ¼kle
   - `loadPurchaseNotifications()` - Paket bildirimlerini yÃ¼kle
   - `showLeadPreview()` - Lead Ã¶nizleme modali

---

## ğŸ”’ GÃœVENLÄ°K KURALLARI

1. **Spam Ã–nleme:**
   - AynÄ± usta 5 dakikada 1 istek yapabilir
   - Rate limiting

2. **DoÄŸrulama:**
   - UstanÄ±n kalan lead'i var mÄ±?
   - Paket aktif mi?
   - Ã–deme tamamlanmÄ±ÅŸ mÄ±?

3. **Log:**
   - TÃ¼m istekleri kaydet
   - Admin onaylarÄ±nÄ± logla
   - Lead gÃ¶nderimlerini takip et

---

## ğŸ“ HIZLI Ã–ZET - COPY/PASTE Ä°Ã‡Ä°N

### **3 Basit Kural:**

```
1. Paket satÄ±n alÄ±ndÄ±
   â†’ Admin paneline BÄ°LDÄ°RÄ°M
   â†’ Admin kontrol eder
   â†’ Admin MANUEL 1 lead gÃ¶nderir

2. Usta "Lead Ä°ste" butonuna bastÄ±
   â†’ Admin paneline BÄ°LDÄ°RÄ°M
   â†’ Admin kontrol eder
   â†’ Admin MANUEL 1 lead gÃ¶nderir

3. Usta "Lead Ä°ste" butonuna BASMAZSA
   â†’ Lead GÃ–NDERÄ°LMEZ
   â†’ Ã‡Ã¼nkÃ¼ mÃ¼sait deÄŸil demektir
```

### **1 Ã–nemli Yasak:**

```
âŒ OTOMATÄ°K GÃ–NDERIM YAPMA!

HiÃ§bir koÅŸulda, hiÃ§bir durumda,
otomatik lead gÃ¶nderme sistemi kurma.

Her lead, admin'in "GÃ¶nder" butonuna
basmasÄ±yla gider. BaÅŸka yolu yok.
```

---

**SON GÃœNCELLEME:** 2024-11-18

**HAZIRLAYAN:** AI Assistant

**DURUM:** âœ… GÃœNCELLEME TAMAMLANDI - MANUEL GÃ–NDERIM SÄ°STEMÄ°

**VERSÄ°YON:** 2.0 - Manuel Admin KontrolÃ¼


```
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•    â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â•šâ•â•
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ•—
â•šâ•â•â•â•â•â• â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•   â•šâ•â•       â•šâ•â•
```

## ğŸ”´ğŸ”´ğŸ”´ Ã‡OK Ã–NEMLÄ° - ASLA UNUTMA! ğŸ”´ğŸ”´ğŸ”´

Bu dÃ¶kÃ¼man, lead'lerin ustalara nasÄ±l gÃ¶nderileceÄŸini aÃ§Ä±klar.

---

## ğŸš¨ğŸš¨ğŸš¨ KRÄ°TÄ°K KURAL: OTOMATÄ°K GÃ–NDERIM YOK! ğŸš¨ğŸš¨ğŸš¨

### **TÃœM LEAD'LER SADECE ADMÄ°N TARAFINDAN MANUEL GÃ–NDERÄ°LÄ°R!**

```
âŒ ASLA otomatik gÃ¶nderim yapma
âŒ ASLA cron job kullanma
âŒ ASLA scheduled task kullanma
âŒ ASLA auto-assign yapma

âœ… HER ZAMAN admin tÄ±klar
âœ… HER ZAMAN admin kontrol eder
âœ… HER ZAMAN admin onaylar
âœ… HER ZAMAN manuel iÅŸlem
```

---

## ğŸ¯ SÄ°STEM AKIÅI

### **1. Paket SatÄ±n Alma Senaryosu**

#### **Ã–rnek Durum:**
- **Åehir:** Riyadh
- **Hizmet TÃ¼rÃ¼:** Elektrik (electric)
- **3 Usta var:**
  - **Usta A:** BugÃ¼n (Pazartesi) 3'lÃ¼ paket aldÄ± â†’ SÄ±ra: 1
  - **Usta B:** BugÃ¼n (Pazartesi) 3'lÃ¼ paket aldÄ± â†’ SÄ±ra: 2
  - **Usta C:** YarÄ±n (SalÄ±) 3'lÃ¼ paket aldÄ± â†’ SÄ±ra: 3

---

## ğŸ“¦ PAKET SATIN ALINDIKTA NE OLUR?

### **Ä°LK LEAD - ADMÄ°N MANUEL GÃ–NDERÄ°R**

âœ… **Paket satÄ±n alÄ±ndÄ±ÄŸÄ±nda:**
```
- Admin paneline BÄ°LDÄ°RÄ°M gelir
- Admin, yeni paket satÄ±n alÄ±ndÄ±ÄŸÄ±nÄ± gÃ¶rÃ¼r
- Admin, sistemde uygun lead var mÄ± kontrol eder
- Varsa â†’ Admin MANUEL olarak 1 adet lead gÃ¶nderir
```

âŒ **Sistemde lead yoksa:**
```
- Admin bekler
- Yeni lead sisteme girdiÄŸinde
- Admin sÄ±raya gÃ¶re gÃ¶nderir
```

### ğŸ”´ **NEDEN OTOMATÄ°K DEÄÄ°L?**

**Ã‡Ã¼nkÃ¼:**
1. Lead kalitesi admin kontrolÃ¼ gerektirir
2. Usta bilgileri doÄŸru mu kontrol edilmeli
3. Lead usta iÃ§in uygun mu deÄŸerlendirilmeli
4. Her lead deÄŸerli, otomatik spam riski var

---

## ğŸ”” KALAN LEAD'LER - USTA TALEBÄ° Ä°LE

### **Kritik Kural: "LEAD Ä°STE" BUTONU - ZORUNLU!**

**Kalan 2 lead iÃ§in:**

1. âœ… **Usta "Lead Ä°ste" butonuna MUTLAKA basmalÄ±**
   - Bu buton provider dashboard'da olacak
   - Her tÄ±klamada 1 lead isteÄŸi admin paneline dÃ¼ÅŸer
   - Admin panelinde "Yeni Ä°stek" bildirimi gelir

2. âœ… **Admin kontrol eder ve MANUEL gÃ¶nderir:**
   - Usta lead istedi mi? â†’ MÃ¼sait demektir!
   - Sistemde uygun lead var mÄ± kontrol eder
   - Varsa â†’ Admin MANUEL olarak gÃ¶nderir
   - Yoksa â†’ Bekler, yeni lead geldiÄŸinde gÃ¶nderir

3. âŒ **Usta lead isteÄŸi gÃ¶ndermezse:**
   - Lead ASLA GÃ–NDERÄ°LMEZ!
   - Ã‡Ã¼nkÃ¼ mÃ¼sait olup olmadÄ±ÄŸÄ± belli deÄŸil
   - MÃ¼sait olmayan ustaya lead gÃ¶nderilirse:
     - âŒ MÃ¼ÅŸteri hizmet alamaz (usta mÃ¼sait deÄŸil)
     - âŒ Lead boÅŸa gider
     - âŒ DiÄŸer hazÄ±r bekleyen ustalar lead alamaz

### ğŸ¯ **NEDEN "LEAD Ä°STE" BUTONU ZORUNLU?**

**Senaryo 1: Usta mÃ¼sait DEÄÄ°L**
```
Usta A: 3'lÃ¼ paket aldÄ±, 1 lead aldÄ±
  â†“
Usta A: YoÄŸun, ÅŸu an Ã§alÄ±ÅŸamaz
  â†“
"Lead Ä°ste" butonuna BASMIYOR
  â†“
Admin: Usta mÃ¼sait deÄŸil, lead gÃ¶ndermez
  â†“
âœ… Lead boÅŸa gitmedi
âœ… DiÄŸer ustalar lead alabilir
```

**Senaryo 2: Usta MÃœSAÄ°T**
```
Usta B: 3'lÃ¼ paket aldÄ±, 1 lead aldÄ±
  â†“
Usta B: HazÄ±r, yeni mÃ¼ÅŸteri istiyorum
  â†“
"Lead Ä°ste" butonuna BASIYOR
  â†“
Admin: Usta mÃ¼sait! â†’ Lead gÃ¶nder
  â†“
âœ… Usta mÃ¼ÅŸteri aldÄ±
âœ… MÃ¼ÅŸteri hizmet aldÄ±
âœ… Sistem saÄŸlÄ±klÄ± Ã§alÄ±ÅŸÄ±yor
```

---

## ğŸ“Š Ã–RNEK SENARYO - ADIM ADIM

### **Senaryo: 3 Usta, 5 Yeni Lead**

#### **BaÅŸlangÄ±Ã§ Durumu:**
```
Usta A (Pazartesi satÄ±n aldÄ±): 
  - Toplam: 3 lead
  - Kalan: 3 lead
  - Otomatik gÃ¶nderilen: 0

Usta B (Pazartesi satÄ±n aldÄ±):
  - Toplam: 3 lead
  - Kalan: 3 lead
  - Otomatik gÃ¶nderilen: 0

Usta C (SalÄ± satÄ±n aldÄ±):
  - Toplam: 3 lead
  - Kalan: 3 lead
  - Otomatik gÃ¶nderilen: 0
```

---

### **ADIM 1: Paket SatÄ±n Alma (Pazartesi)**

**Usta A, 3'lÃ¼ paket satÄ±n alÄ±r (Saat 10:00):**
```
âœ… Admin paneline BÄ°LDÄ°RÄ°M gelir: "Yeni paket satÄ±n alÄ±ndÄ±"
âœ… Admin kontrol eder: Sistemde 2 lead var (Riyadh + Elektrik)
âœ… Admin MANUEL olarak 1 lead gÃ¶nderir
âœ… Kalan: 2 lead (beklemede - usta isteÄŸi gerekli)
```

**Usta B, 3'lÃ¼ paket satÄ±n alÄ±r (Saat 14:00):**
```
âœ… Admin paneline BÄ°LDÄ°RÄ°M gelir
âœ… Admin kontrol eder: Sistemde 1 lead kaldÄ±
âœ… Admin MANUEL olarak 1 lead gÃ¶nderir
âœ… Kalan: 2 lead (beklemede - usta isteÄŸi gerekli)
```

**Durum Ã–zeti (Pazartesi AkÅŸam):**
```
Usta A: 1 lead aldÄ± (admin gÃ¶nderdi), 2 bekliyor
Usta B: 1 lead aldÄ± (admin gÃ¶nderdi), 2 bekliyor
Sistemde: 0 lead kaldÄ±
Admin: Ä°ki ustaya da ilk lead'i gÃ¶nderdi âœ…
```

---

### **ADIM 2: Yeni Lead Gelir (SalÄ± Sabah)**

**Sistem:** 2 yeni mÃ¼ÅŸteri kaydÄ± geldi (Riyadh + Elektrik)

**Ama kimseye GÃ–NDERÄ°LMEZ Ã§Ã¼nkÃ¼:**
âŒ Usta A "Lead Ä°ste" butonuna basmadÄ±
âŒ Usta B "Lead Ä°ste" butonuna basmadÄ±

```
Lead'ler beklemede kalÄ±r!
```

---

### **ADIM 3: Usta A "Lead Ä°ste" Butonuna Basar**

**Usta A, dashboard'dan "Lead Ä°ste" butonuna tÄ±klar:**
```
âœ… Ä°stek admin paneline dÃ¼ÅŸer
âœ… Admin panelinde BÄ°LDÄ°RÄ°M: "Usta A lead istiyor - MÃœSAÄ°T!"
âœ… Admin kontrol eder: "Sistemde 2 lead var"
âœ… Admin MANUEL olarak 1 lead Usta A'ya gÃ¶nderir
âœ… Ä°stek durumu: "TamamlandÄ±" olarak iÅŸaretlenir
```

**Durum:**
```
Usta A: 2 lead aldÄ±, 1 bekliyor
Usta B: 1 lead aldÄ±, 2 bekliyor (henÃ¼z istemedi - mÃ¼sait deÄŸil!)
Sistemde: 1 lead kaldÄ±
```

---

### **ADIM 4: Usta C Paket SatÄ±n AlÄ±r (SalÄ± Ã–ÄŸleden Sonra)**

**Usta C, 3'lÃ¼ paket satÄ±n alÄ±r:**
```
âœ… Admin paneline BÄ°LDÄ°RÄ°M gelir
âœ… Admin kontrol eder: Sistemde 1 lead var
âœ… Admin MANUEL olarak 1 lead gÃ¶nderir
âœ… Kalan: 2 lead (beklemede - usta isteÄŸi gerekli)
```

**Durum:**
```
Usta A: 2 lead aldÄ±, 1 bekliyor (sÄ±ra: 1)
Usta B: 1 lead aldÄ±, 2 bekliyor (sÄ±ra: 2 - henÃ¼z istemedi!)
Usta C: 1 lead aldÄ±, 2 bekliyor (sÄ±ra: 3)
Sistemde: 0 lead
```

---

### **ADIM 5: Yeni Lead + Talepler**

**3 yeni mÃ¼ÅŸteri kaydÄ± geldi (Ã‡arÅŸamba):**

1. **Usta A "Lead Ä°ste" butonuna basar:**
   - âœ… Ä°stek admin paneline dÃ¼ÅŸer
   - âœ… Admin: "Usta A mÃ¼sait! Sistemde 3 lead var"
   - âœ… Admin MANUEL olarak 1 lead gÃ¶nderir
   - âœ… Usta A'nÄ±n paketi tamamlandÄ±! (3/3)

2. **Usta B "Lead Ä°ste" butonuna basar (ilk kez):**
   - âœ… Ä°stek admin paneline dÃ¼ÅŸer
   - âœ… Admin: "Usta B mÃ¼sait! Sistemde 2 lead var"
   - âœ… Admin MANUEL olarak 1 lead gÃ¶nderir
   - âœ… Usta B: 2/3 lead aldÄ±

3. **Usta B tekrar "Lead Ä°ste" butonuna basar:**
   - âœ… Ä°stek admin paneline dÃ¼ÅŸer
   - âœ… Admin: "Sistemde 1 lead var"
   - âœ… Admin MANUEL olarak 1 lead gÃ¶nderir
   - âœ… Usta B'nin paketi tamamlandÄ±! (3/3)

4. **ArtÄ±k sÄ±ra Usta C'de:**
   - Usta C "Lead Ä°ste" butonuna basarsa
   - Admin bildirimi alÄ±r
   - Admin lead gÃ¶nderir

---

## ğŸš¨ KRÄ°TÄ°K KURALLAR

### âœ… **YAPILMASI GEREKENLER:**

1. **Paket satÄ±n alÄ±ndÄ±ÄŸÄ±nda:**
   - âœ… Admin paneline BÄ°LDÄ°RÄ°M gÃ¶nder
   - âœ… Admin sistemde lead var mÄ± kontrol eder
   - âœ… Varsa â†’ Admin MANUEL olarak 1 adet gÃ¶nderir
   - âœ… Yoksa â†’ Admin bekler, lead geldiÄŸinde gÃ¶nderir

2. **Kalan lead'ler iÃ§in (ZORUNLU):**
   - âœ… Usta "Lead Ä°ste" butonuna MUTLAKA basmalÄ±
   - âœ… Admin panelinde "Yeni Ä°stek" bildirimi gelsin
   - âœ… Admin kontrol edip MANUEL gÃ¶nderir
   - âœ… Ä°stek durumu gÃ¼ncellenir (pending â†’ completed)

3. **SÄ±ralama (Admin kontrolÃ¼):**
   - âœ… Ä°lk satÄ±n alan â†’ Ä°lk sÄ±rada
   - âœ… AynÄ± gÃ¼n satÄ±n alanlar â†’ Saat sÄ±rasÄ±na gÃ¶re
   - âœ… Paket bitince â†’ Sonraki sÄ±raya geÃ§
   - âœ… Admin her zaman sÄ±rayÄ± kontrol eder

### âŒ **YAPILMAMASI GEREKENLER:**

1. **âŒ OTOMATÄ°K GÃ–NDERIM YASAK:**
   - âŒ ASLA otomatik lead gÃ¶nderme
   - âŒ Her ÅŸey admin kontrolÃ¼nde olmalÄ±
   - âŒ "Auto-assign" Ã¶zelliÄŸi YOK

2. **âŒ Ä°stek olmadan gÃ¶nderme:**
   - âŒ Usta istemediÄŸi halde gÃ¶nderme
   - âŒ "Lead Ä°ste" butonu ZORUNLU
   - âŒ MÃ¼sait olmayan ustaya lead gÃ¶nderme

3. **âŒ SÄ±ra atlatma:**
   - âŒ Sonraki ustaya geÃ§me (Ã¶nceki bitmeden/istekte bulunmadan)
   - âŒ Admin bile sÄ±rayÄ± atlayamaz (Ã¶zel durumlar hariÃ§)

### ğŸ”´ **EN Ã–NEMLÄ° KURAL:**

**TÃœM LEAD GÃ–NDERÄ°MLERÄ° ADMÄ°N TARAFINDAN MANUEL YAPILIR!**

**Neden?**
- Lead kalitesi kontrolÃ¼
- Usta mÃ¼saitlik kontrolÃ¼
- DoÄŸru eÅŸleÅŸtirme kontrolÃ¼
- Spam/hata Ã¶nleme

---

## ğŸ¯ SONUÃ‡

### **Sistem MantÄ±ÄŸÄ±:**

```
1. Paket Al â†’ Admin BÄ°LDÄ°RÄ°M alÄ±r
2. Admin Kontrol â†’ Ä°lk Lead MANUEL gÃ¶nderir (varsa)
3. Kalan Lead'ler â†’ Usta "Lead Ä°ste" butonuna basar
4. Admin BÄ°LDÄ°RÄ°M alÄ±r â†’ Kontrol â†’ MANUEL gÃ¶nderir
5. Paket Bitince â†’ Sonraki SÄ±raya
```

### **Neden Bu Sistem?**

âœ… **Admin kontrolÃ¼:** Her lead admin onayÄ± ile gider
âœ… **Usta mÃ¼saitlik kontrolÃ¼:** "Lead Ä°ste" = Ben hazÄ±rÄ±m!
âœ… **Lead kalitesi:** MÃ¼sait usta = daha iyi hizmet
âœ… **Adil daÄŸÄ±tÄ±m:** SÄ±ra sistemi (admin takibi)
âœ… **Spam Ã¶nleme:** Otomatik bombardÄ±man YOK
âœ… **DoÄŸruluk:** Admin lead-usta uyumunu kontrol eder

### **ğŸ”´ TEKRAR: OTOMATÄ°K GÃ–NDERIM YOK!**

**Her lead gÃ¶nderimi:**
- âœ… Admin gÃ¶rÃ¼r
- âœ… Admin kontrol eder
- âœ… Admin tÄ±klayarak gÃ¶nderir
- âœ… Admin onaylar

**ASLA:**
- âŒ Otomatik sistem gÃ¶nderimi yok
- âŒ Scheduled job gÃ¶nderimi yok
- âŒ Cron job gÃ¶nderimi yok

---

## ğŸ“Œ Ã–RNEK DATABASE AKIÅI

### **1. Paket SatÄ±n Alma:**
```sql
INSERT INTO provider_purchases (
    provider_id, package_id, leads_count, remaining_leads, 
    payment_status, purchased_at
) VALUES (
    3, 1, 3, 3, 'completed', NOW()
);
```

### **2. Ä°lk Lead - Admin Manuel GÃ¶nderim:**
```sql
-- Admin panelinde: Yeni paket bildirimi
-- Admin kontrol eder: Sistemde lead var mÄ±?
SELECT * FROM leads 
WHERE city = 'Riyadh' AND service_type = 'electric' 
AND status = 'new' 
LIMIT 1;

-- Admin "Lead GÃ¶nder" butonuna tÄ±klar
INSERT INTO provider_lead_deliveries (
    purchase_id, provider_id, lead_id, 
    delivery_method, delivered_at, delivered_by
) VALUES (
    123, 3, 456, 'admin_manual', NOW(), 1
);

-- Kalan lead'i azalt
UPDATE provider_purchases 
SET remaining_leads = remaining_leads - 1 
WHERE id = 123;

-- Lead durumunu gÃ¼ncelle
UPDATE leads 
SET status = 'sold' 
WHERE id = 456;
```

### **3. "Lead Ä°ste" Ä°steÄŸi:**
```sql
INSERT INTO lead_requests (
    provider_id, purchase_id, 
    request_status, requested_at
) VALUES (
    3, 123, 'pending', NOW()
);
```

### **4. Admin Manuel OnayÄ± ve GÃ¶nderimi:**
```sql
-- Admin panelinde istek gÃ¶rÃ¼nÃ¼r
-- Admin "Lead GÃ¶nder" butonuna tÄ±klar

-- Ä°steÄŸi onayla
UPDATE lead_requests 
SET request_status = 'approved', 
    approved_at = NOW(),
    approved_by = 1  -- admin ID
WHERE id = 789;

-- Lead'i MANUEL gÃ¶nder
INSERT INTO provider_lead_deliveries (
    purchase_id, provider_id, lead_id, 
    delivery_method, delivered_at, delivered_by,
    request_id
) VALUES (
    123, 3, 457, 'admin_manual', NOW(), 1, 789
);

-- Kalan lead'i azalt
UPDATE provider_purchases 
SET remaining_leads = remaining_leads - 1 
WHERE id = 123;

-- Lead durumunu gÃ¼ncelle
UPDATE leads 
SET status = 'sold' 
WHERE id = 457;
```

---

## ğŸ¨ UI/UX GEREKSÄ°NÄ°MLERÄ°

### **Provider Dashboard:**

1. **"Lead Ä°ste" Butonu:**
   ```
   - Her pakette gÃ¶rÃ¼nmeli
   - Kalan lead varsa aktif
   - TÄ±klanÄ±nca â†’ Ä°stek gÃ¶nder
   - Loading animasyonu
   - Success mesajÄ±
   ```

2. **Paket Durumu KartÄ±:**
   ```
   - Toplam Lead: 3
   - AlÄ±nan Lead: 1
   - Kalan Lead: 2
   - "Lead Ä°ste" Butonu (2 kez basabilir)
   ```

### **Admin Panel:**

1. **Yeni Paket Bildirimleri:**
   ```
   - "Yeni Paket SatÄ±n AlÄ±ndÄ±" bildirimi
   - Usta AdÄ± + Paket DetayÄ±
   - "Ä°lk Lead'i GÃ¶nder" butonu
   - Sistemde uygun lead var mÄ± gÃ¶stergesi
   ```

2. **Lead Ä°stekleri Tablosu:**
   ```
   - Usta AdÄ±
   - Paket Bilgisi
   - Ä°stek Tarihi
   - Durum (Beklemede/OnaylandÄ±)
   - "Lead GÃ¶nder" Butonu (MANUEL)
   - Bildirim sayÄ±sÄ± (kaÃ§ bekleyen istek var)
   ```

3. **Lead Havuzu:**
   ```
   - KullanÄ±labilir lead'ler
   - Filtreleme (ÅŸehir, hizmet tÃ¼rÃ¼)
   - "Bu Lead'i GÃ¶nder" butonu
   - Usta seÃ§imi dropdown
   ```

4. **âŒ OTOMATÄ°K KONTROL YOK:**
   ```
   âŒ Otomatik gÃ¶nderim YOK
   âŒ Cron job YOK
   âŒ Auto-assign YOK
   âœ… Sadece MANUEL admin gÃ¶nderimi
   ```

---

## âœ… UYGULAMA PLANI

### **Gerekli Tablolar:**

1. **lead_requests** (yeni tablo):
   ```sql
   CREATE TABLE lead_requests (
       id INT AUTO_INCREMENT PRIMARY KEY,
       provider_id INT NOT NULL,
       purchase_id INT NOT NULL,
       request_status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending',
       requested_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
       approved_at TIMESTAMP NULL,
       approved_by INT NULL,
       notes TEXT NULL,
       FOREIGN KEY (provider_id) REFERENCES service_providers(id),
       FOREIGN KEY (purchase_id) REFERENCES provider_purchases(id),
       FOREIGN KEY (approved_by) REFERENCES admins(id)
   );
   ```

### **Gerekli Fonksiyonlar:**

1. **Backend (PHP) - Provider:**
   - `requestLead()` - Usta lead ister (AJAX endpoint)
   - `getMyRequests()` - UstanÄ±n isteklerini listeler

2. **Backend (PHP) - Admin:**
   - `listPendingRequests()` - Bekleyen istekleri listeler
   - `sendLeadManually()` - Admin MANUEL lead gÃ¶nderir
   - `getPurchaseNotifications()` - Yeni paket bildirimlerini getirir
   - `getAvailableLeads()` - Mevcut lead'leri listeler
   - âŒ `autoAssignLead()` - BU FONKSÄ°YON YOK!
   - âŒ `autoCheckAndSend()` - BU FONKSÄ°YON YOK!

3. **Frontend (JavaScript) - Provider:**
   - `requestLeadButton()` - AJAX request
   - `showRequestStatus()` - Durum gÃ¶ster
   - `updateRemainingLeads()` - Kalan lead gÃ¼ncelle

4. **Frontend (JavaScript) - Admin:**
   - `sendLeadToProvider()` - Lead gÃ¶nder butonu (AJAX)
   - `loadPendingRequests()` - Ä°stekleri yÃ¼kle
   - `loadPurchaseNotifications()` - Paket bildirimlerini yÃ¼kle
   - `showLeadPreview()` - Lead Ã¶nizleme modali

---

## ğŸ”’ GÃœVENLÄ°K KURALLARI

1. **Spam Ã–nleme:**
   - AynÄ± usta 5 dakikada 1 istek yapabilir
   - Rate limiting

2. **DoÄŸrulama:**
   - UstanÄ±n kalan lead'i var mÄ±?
   - Paket aktif mi?
   - Ã–deme tamamlanmÄ±ÅŸ mÄ±?

3. **Log:**
   - TÃ¼m istekleri kaydet
   - Admin onaylarÄ±nÄ± logla
   - Lead gÃ¶nderimlerini takip et

---

## ğŸ“ HIZLI Ã–ZET - COPY/PASTE Ä°Ã‡Ä°N

### **3 Basit Kural:**

```
1. Paket satÄ±n alÄ±ndÄ±
   â†’ Admin paneline BÄ°LDÄ°RÄ°M
   â†’ Admin kontrol eder
   â†’ Admin MANUEL 1 lead gÃ¶nderir

2. Usta "Lead Ä°ste" butonuna bastÄ±
   â†’ Admin paneline BÄ°LDÄ°RÄ°M
   â†’ Admin kontrol eder
   â†’ Admin MANUEL 1 lead gÃ¶nderir

3. Usta "Lead Ä°ste" butonuna BASMAZSA
   â†’ Lead GÃ–NDERÄ°LMEZ
   â†’ Ã‡Ã¼nkÃ¼ mÃ¼sait deÄŸil demektir
```

### **1 Ã–nemli Yasak:**

```
âŒ OTOMATÄ°K GÃ–NDERIM YAPMA!

HiÃ§bir koÅŸulda, hiÃ§bir durumda,
otomatik lead gÃ¶nderme sistemi kurma.

Her lead, admin'in "GÃ¶nder" butonuna
basmasÄ±yla gider. BaÅŸka yolu yok.
```

---

**SON GÃœNCELLEME:** 2024-11-18

**HAZIRLAYAN:** AI Assistant

**DURUM:** âœ… GÃœNCELLEME TAMAMLANDI - MANUEL GÃ–NDERIM SÄ°STEMÄ°

**VERSÄ°YON:** 2.0 - Manuel Admin KontrolÃ¼



